name: Check src Changes

on:
  pull_request:
    branches:
      - develop
      - release
      - main
  push:
    branches:
      - release

jobs:
  check-src-changes:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Compare src/ directory changes
        id: src-changes
        run: |
          # Determine the base branch to compare against
          BASE_REF="${{ github.event.pull_request.base.ref || 'origin/main' }}"
          
          # Check for changes in the src directory
          if git diff --name-only "$BASE_REF"...HEAD | grep '^src/'; then
            echo "Changes found in src/ directory"
            echo "src_changes=true" >> $GITHUB_ENV
          else
            echo "No changes in src/ directory"
            echo "src_changes=false" >> $GITHUB_ENV
          fi

      - name: Fail if src/ has changes
        if: env.src_changes == 'true'
        run: |
          echo "This pull request includes changes in the src/ directory. Please ensure this complies with branch naming policies."
          exit 1
